{deck}
version:1
card:0
size:[512,342]
script:"0"
name:"xmooks.deck"
author:"strategineer"

{script:0}
on stat_to_mod x do
 floor (x/3)-3 #GLOG classic.
end
{end}

{card:Home}
image:"%%IMG2AgABVgD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wAnAacA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgEBAKUBAQD/AFoBAQClAQEA/wBaAQEApQEBAP8AWgGnAP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A9gEBAP8A/wEBAAEBAQD/AP4BAQABAQEAAwEBAP8A+QEBAAMBAQD/APwBAQADAQEA/wD7AQEABQEBAP8A+gEHAAEBAQD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wDP"
script:"Home.0"
{widgets}
CharacterName:{"type":"field","size":[64,19],"pos":[107,18],"font":"menu","style":"plain","align":"center","value":"name"}
Statistic1:{"type":"contraption","size":[165,20],"pos":[5,146],"script":"Home.1","def":"Statistic","widgets":{"name":{},"score":{"value":11},"modifier":{},"roll":{"show":"none"}}}
Statistic2:{"type":"contraption","size":[165,20],"pos":[5,168],"script":"Home.2","def":"Statistic","widgets":{"name":{"value":"Dex"},"score":{"value":9},"modifier":{},"roll":{"show":"none"}}}
Statistic3:{"type":"contraption","size":[165,20],"pos":[5,190],"script":"Home.3","def":"Statistic","widgets":{"name":{"value":"Con"},"score":{"value":4},"modifier":{"value":"-2"},"roll":{"show":"none"}}}
Statistic4:{"type":"contraption","size":[165,20],"pos":[5,212],"script":"Home.4","def":"Statistic","widgets":{"name":{"value":"Int"},"score":{"value":15},"modifier":{"value":"+2"},"roll":{"show":"none"}}}
Statistic5:{"type":"contraption","size":[165,20],"pos":[5,234],"script":"Home.5","def":"Statistic","widgets":{"name":{"value":"Wis"},"score":{"value":15},"modifier":{"value":"+2"},"roll":{"show":"none"}}}
Statistic6:{"type":"contraption","size":[165,20],"pos":[5,256],"script":"Home.6","def":"Statistic","widgets":{"name":{"value":"Cha"},"score":{"value":17},"modifier":{"value":"+2"},"roll":{"show":"none"}}}
level:{"type":"slider","size":[43,17],"pos":[128,39],"script":"Home.7","interval":[0,20],"value":1,"style":"compact"}
label1:{"type":"field","size":[21,17],"pos":[106,39],"locked":1,"value":"LVL"}
label2:{"type":"field","size":[17,18],"pos":[5,124],"locked":1,"value":"HP"}
HP:{"type":"slider","size":[99,17],"pos":[23,125],"interval":[0,1],"value":1,"format":"%f/1","style":"bar"}
MaxHP:{"type":"field","size":[17,17],"pos":[155,125],"locked":1,"script":"Home.8","style":"code","value":"1"}
customfield1:{"type":"field","size":[65,17],"pos":[106,57]}
customfield2:{"type":"field","size":[65,17],"pos":[106,74]}
customfield3:{"type":"field","size":[65,17],"pos":[106,91]}
template1:{"type":"field","size":[175,58],"pos":[332,22],"script":"Home.9","scrollbar":1,"value":"A: Spellcasting\n+1 MD, +1 Spell Slot, +1 Spell(1-6)"}
template2:{"type":"field","size":[175,54],"pos":[332,83],"show":"invert","scrollbar":1,"value":"?:"}
template3:{"type":"field","size":[175,59],"pos":[332,140],"show":"invert","scrollbar":1,"value":"?:"}
template4:{"type":"field","size":[175,56],"pos":[332,203],"show":"invert","scrollbar":1,"value":"?:"}
SpellsButton:{"type":"button","size":[39,20],"pos":[468,317],"script":"Home.10","text":"Spells"}
label3:{"type":"field","size":[29,18],"pos":[125,124],"locked":1,"border":1,"value":{"text":["","Max:"],"font":["","body"],"arg":["",""]}}
Inventory:{"type":"grid","size":[140,115],"pos":[174,38],"script":"Home.11","scrollbar":1,"headers":0,"bycell":1,"widths":[99],"format":"si","value":{"INVENTORY":["Blanket","3x Rations","","","","","","","","","","","","","","","","","",""],"#":[1,1,"","","","","","","","","","","","","","","","","",""]},"row":2,"col":1}
DeltaButton:{"type":"button","size":[42,20],"pos":[332,317],"script":"Home.12","text":"Deltas"}
label8:{"type":"field","size":[138,17],"pos":[175,21],"locked":1,"font":"menu","show":"invert","align":"center","value":"INVENTORY"}
statroller1:{"type":"contraption","size":[140,156],"pos":[174,182],"def":"statroller","widgets":{"label":{},"button1":{"pos":[0,84]},"button2":{"pos":[0,96]},"button3":{"pos":[0,108]},"button4":{"pos":[0,120]},"button5":{"pos":[0,132]},"button6":{"pos":[0,144]},"roll":{"size":[93,156],"pos":[47,0],"value":"19\n10\n4\n14\n13\n15\n6\n5\n17\n13\n17\n1\n3\n15\n7\n18\n3 (4-1)\n12 (13-1)\n19 (20-1)\n18 (19-1)\n15 (16-1)\n8 (8+0)\n13 (13+0)\n15 (15+0)\n3 (3+0)\n2 (2+0)\n14 (14+0)\n3 (3+0)\n18\n18\n7\n4\n7\n1"},"grid1":{"size":[65,160],"value":{"score":[11,9,4,15,15,17]},"row":5},"d20":{"size":[46,56],"pos":[0,28]}}}
NotesButton:{"type":"button","size":[40,20],"pos":[401,317],"script":"Home.13","text":"Notes"}
Portrait:{"type":"canvas","size":[100,100],"pos":[5,22],"image":"%%IMG2AGQAZAD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wA3","scale":1}
template5:{"type":"field","size":[175,51],"pos":[332,262],"show":"invert","scrollbar":1,"value":"?:"}
field1:{"type":"field","size":[55,25],"pos":[174,155],"font":"mono","value":"Armor Bonus"}
attack:{"type":"contraption","size":[50,21],"pos":[6,279],"def":"DerivedStatistic","widgets":{"name":{"value":"Atk"},"val":{"value":"11"}}}
defense:{"type":"contraption","size":[50,21],"pos":[58,279],"def":"DerivedStatistic","widgets":{"name":{"value":"Def"},"val":{"value":"10"}}}
movement:{"type":"contraption","size":[50,21],"pos":[112,278],"def":"DerivedStatistic","widgets":{"name":{"value":"Mov"},"val":{"value":"12"}}}
stealth:{"type":"contraption","size":[50,21],"pos":[5,305],"def":"DerivedStatistic","widgets":{"name":{"value":"Stlth"},"val":{"value":"5"}}}
save:{"type":"contraption","size":[50,21],"pos":[59,305],"def":"DerivedStatistic","widgets":{"name":{"value":"Save"},"val":{"value":"8"}}}
ClearPortrait:{"type":"button","size":[36,20],"pos":[6,101],"script":"Home.14","text":"clear"}
armor_bonus:{"type":"slider","size":[83,25],"pos":[231,154],"script":"Home.15","interval":[0,6],"step":2,"style":"compact"}

{script:Home.0}
on view do
 update_derived_stats[]
 update_max_hp[]
end

on update_max_hp do
 s:Statistic3.score
 if s>0
  l:level.value
  if l<2
   r:(s-4)
  elseif l=2
   r:(s-2)
  elseif l=3
   r:s
  elseif l=4
   r:(s+2)
  elseif l=5
   r:(s+4)
  else
   r:(s+l)
  end
  r:(r & 20)
  r:(r | 1)
  print["level: %i, score: %i, r: %r" format (l, s, r)]
  MaxHP.text:r 
  MaxHP.event["change" r] 
 end
end

on update_derived_stats do
 armor_penalty:0
 if armor_bonus.value=2
  armor_penalty:0
 elseif armor_bonus.value=4
  armor_penalty:-2
 elseif armor_bonus.value=6
  armor_penalty:-4
 end
 attack.update_stat[level.value Statistic2.mod Statistic6.mod armor_bonus.value armor_penalty]
 defense.update_stat[level.value Statistic2.mod Statistic6.mod armor_bonus.value armor_penalty]
 movement.update_stat[level.value Statistic2.mod Statistic6.mod armor_bonus.value armor_penalty]
 stealth.update_stat[level.value Statistic2.mod Statistic6.mod armor_bonus.value armor_penalty]
 save.update_stat[level.value Statistic2.mod Statistic6.mod armor_bonus.value armor_penalty]
end
{end}

{script:Home.1}
on change a s do
 statroller1.setstat[0 a s]
end
{end}

{script:Home.2}
on change a s do
 statroller1.setstat[1 a s]
 card.event["update_derived_stats"]
end
{end}

{script:Home.3}
on change a s do
 statroller1.setstat[2 a s]
 card.event["update_max_hp"]
end
{end}

{script:Home.4}
on change a s do
 statroller1.setstat[3 a s]
end
{end}

{script:Home.5}
on change a s do
 statroller1.setstat[4 a s]
end
{end}

{script:Home.6}
on change a s do
 statroller1.setstat[5 a s]
 card.event["update_derived_stats"]
end
{end}

{script:Home.7}
on change val do
 if val>4
  template5.show:"solid"
 elseif val>3
  template5.show:"invert"
  template4.show:"solid"
 elseif val>2
  template4.show:"invert"
  template3.show:"solid"
 elseif val>1
  template3.show:"invert"
  template2.show:"solid"
 elseif val>0
  template2.show:"invert"
  template1.show:"solid"
 else
  template1.show:"invert"
 end
 card.event["update_derived_stats"]
 card.event["update_max_hp"]
end
{end}

{script:Home.8}
on change val do
 HP.format:"" fuse ("%f/",val)
 HP.interval:(0,val)
end
{end}

{script:Home.9}
on change val do
 
end
{end}

{script:Home.10}
on click do
  go["Spells" "SlideLeft"]
end
{end}

{script:Home.11}
on click row do
 
end
{end}

{script:Home.12}
on click do
  go["Deltas" "SlideUp"]
end
{end}

{script:Home.13}
on click do
  go["Notes" "SlideDown"]
end
{end}

{script:Home.14}
on click do
 Portrait.clear[]
end
{end}

{script:Home.15}
on change val do
 card.event["update_derived_stats"]
end
{end}

{card:Spells}
{widgets}
button1:{"type":"button","size":[39,20],"pos":[1,18],"script":"Spells.0","text":"Home"}
Spell1:{"type":"contraption","size":[169,72],"pos":[1,41],"def":"Spell","widgets":{"Description":{"size":[169,52],"value":"Spell effect"},"name":{"size":[96,20],"value":"Spell name"},"customfield1":{"pos":[97,0],"value":"Field 1"},"customfield2":{"size":[36,20],"pos":[133,0],"value":"Field 2"}}}
Spell2:{"type":"contraption","size":[169,72],"pos":[1,116],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell3:{"type":"contraption","size":[169,72],"pos":[1,191],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
SpellRoller1:{"type":"contraption","size":[280,96],"pos":[230,17],"def":"SpellRoller","widgets":{"dice":{"value":{"value":[1,2,5]}},"NumDice":{"value":3},"label1":{},"label2":{},"Roll":{},"doubles":{},"Sum":{"value":"Sum:8"}}}
Spell4:{"type":"contraption","size":[169,72],"pos":[1,266],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell5:{"type":"contraption","size":[169,72],"pos":[171,41],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell6:{"type":"contraption","size":[169,72],"pos":[171,116],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell7:{"type":"contraption","size":[169,72],"pos":[171,191],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell8:{"type":"contraption","size":[169,72],"pos":[171,266],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell10:{"type":"contraption","size":[169,72],"pos":[341,116],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell11:{"type":"contraption","size":[169,72],"pos":[341,191],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell12:{"type":"contraption","size":[169,72],"pos":[341,266],"def":"Spell","widgets":{"Description":{"size":[169,52]},"name":{"size":[96,20]},"customfield1":{"pos":[97,0]},"customfield2":{"size":[36,20],"pos":[133,0]}}}
Spell9:{"type":"contraption","size":[132,72],"pos":[341,41],"def":"Spell","widgets":{"Description":{"size":[132,52]},"name":{"size":[75,20]},"customfield1":{"size":[27,20],"pos":[76,0]},"customfield2":{"size":[28,20],"pos":[104,0]}}}

{script:Spells.0}
on click do
  go["Home" "SlideRight"]
end
{end}

{card:Deltas}
{widgets}
button1:{"type":"button","size":[39,20],"pos":[1,18],"script":"Deltas.0","text":"Home"}
Delta1:{"type":"contraption","size":[165,70],"pos":[1,41],"def":"Delta","widgets":{"field1":{"size":[150,70],"value":"Deltas light up with checkbox"},"checkbox":{"size":[13,10],"value":1}}}
Delta2:{"type":"contraption","size":[165,70],"pos":[1,117],"def":"Delta","widgets":{"field1":{"size":[150,70],"value":"Condition:\nEffect"},"checkbox":{"size":[13,10]}}}
Delta5:{"type":"contraption","size":[165,70],"pos":[174,41],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta6:{"type":"contraption","size":[165,70],"pos":[174,117],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta9:{"type":"contraption","size":[165,70],"pos":[346,41],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta10:{"type":"contraption","size":[165,70],"pos":[346,117],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta7:{"type":"contraption","size":[165,70],"pos":[174,193],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta8:{"type":"contraption","size":[165,70],"pos":[174,269],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta11:{"type":"contraption","size":[165,70],"pos":[346,193],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta12:{"type":"contraption","size":[165,70],"pos":[346,269],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta3:{"type":"contraption","size":[165,70],"pos":[1,193],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}
Delta4:{"type":"contraption","size":[165,70],"pos":[1,269],"def":"Delta","widgets":{"field1":{"size":[150,70]},"checkbox":{"size":[13,10]}}}

{script:Deltas.0}
on click do
  go["Home" "SlideDown"]
end
{end}

{card:Notes}
{widgets}
HomeButton:{"type":"button","size":[39,20],"pos":[1,18],"script":"Notes.0","text":"Home"}
field1:{"type":"field","size":[130,301],"pos":[1,40],"scrollbar":1}
field2:{"type":"field","size":[130,301],"pos":[132,40],"scrollbar":1}
field3:{"type":"field","size":[130,301],"pos":[263,40],"scrollbar":1}
grid1:{"type":"grid","size":[117,301],"pos":[394,40],"headers":0,"value":{"notes":["Double-click cell","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},"row":0}
button1:{"type":"button","size":[45,20],"pos":[466,18],"script":"Notes.1","text":"More..."}

{script:Notes.0}
on click do
  go["Home" "SlideUp"]
end
{end}

{script:Notes.1}
on click do
  go["Notes2" "WipeDown"]
end
{end}

{card:Notes2}
{widgets}
HomeButton:{"type":"button","size":[39,20],"pos":[1,18],"script":"Notes.0","text":"Home"}
field1:{"type":"field","size":[130,301],"pos":[1,40],"scrollbar":1}
field2:{"type":"field","size":[130,301],"pos":[132,40],"scrollbar":1}
field3:{"type":"field","size":[130,301],"pos":[263,40],"scrollbar":1}
grid1:{"type":"grid","size":[117,301],"pos":[394,40],"headers":0,"value":{"notes":["Double-click cell","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},"row":1}
button1:{"type":"button","size":[45,20],"pos":[466,18],"script":"Notes2.0","text":"Back..."}

{script:Notes2.0}
on click do
  go["Notes" "WipeUp"]
end
{end}

{contraption:Statistic}
size:[165,20]
margin:[0,0,0,0]
description:"Editable RPG stat with name, value, modifier, and 3d6 roller."
script:"Statistic.0"
template:"on change a s do\n \nend"
attributes:{"name":["abbr","score"],"label":["",""],"type":["string","number"]}
{widgets}
name:{"type":"field","size":[28,20],"pos":[0,0],"script":"Statistic.1","style":"plain","value":"Str"}
score:{"type":"slider","size":[80,20],"pos":[29,0],"script":"Statistic.2","interval":[0,24],"value":10,"style":"bar"}
modifier:{"type":"field","size":[20,20],"pos":[110,0],"locked":1,"script":"Home.9","style":"code","value":"0"}
roll:{"type":"button","size":[34,20],"pos":[131,0],"script":"Statistic.3","text":"3d6","value":0}

{script:Statistic.0}
on get_abbr do
 name.text
end

on set_abbr x do
 name.text:x
 card.event["change" me.abbr me.score]
end

on get_score do
 score.value
end

on set_score x do
 score.value:x
 roll.show:"solid"
 m:deck.event["stat_to_mod" x]
 if x>11
  modifier.value:"" fuse ("+",m)
 else
  modifier.value:m
 end
 card.event["change" me.abbr me.score]
end

on get_mod do
 deck.event["stat_to_mod" score.value]
end
{end}

{script:Statistic.1}
on change val do
 card.event["change" val get_score[]]
end
{end}

{script:Statistic.2}
on change val do
 set_score[val]
 card.event["change" get_abbr[] val]
end
{end}

{script:Statistic.3}
on click do
 set_score[random[6]+random[6]+random[6]+3]
 me.show:"none"
 card.event["change" get_abbr[] get_score[]]
end
{end}

{contraption:SpellRoller}
size:[280,96]
margin:[0,0,0,0]
description:"Rolls a great pile of d6s, and calls out doubles and triples."
attributes:{"name":[],"label":[],"type":[]}
{widgets}
dice:{"type":"grid","size":[36,95],"pos":[244,1],"headers":0,"lines":0,"value":{"value":[2,1,3,1,2,5]}}
NumDice:{"type":"slider","size":[41,16],"pos":[23,4],"interval":[0,13],"value":6,"style":"compact"}
label1:{"type":"field","size":[22,16],"pos":[1,4],"locked":1,"border":0,"value":"Roll"}
label2:{"type":"field","size":[27,16],"pos":[65,4],"locked":1,"border":0,"value":"dice:"}
Roll:{"type":"button","size":[30,16],"pos":[89,4],"script":"SpellRoller.0","text":"Roll!"}
doubles:{"type":"field","size":[87,16],"pos":[119,1],"locked":1,"border":0,"align":"right","value":"Doubles!!"}
Sum:{"type":"field","size":[40,16],"pos":[205,1],"locked":1,"value":"Sum:14"}

{script:SpellRoller.0}
on click do
 #Go ahead and clear the selection
 dice.row:-1
 
 #Roll the dice into the grid
 a:()
 each x in range NumDice.value
  a[x]:random[6]+1
 end
 dice.value:a
 
 #Update the sum display
 Sum.value:"" fuse "Sum:", sum a
 
 #Count each result
 b:()
 each x in a
  b[x]:1+b[x]
 end
 
 #This works but IDK if it's the ideal way to do this. Basically gets how many times the most frequent number occurs
 c: first extract value orderby value desc from b
 
 #Basically a big switch statement
 if c<2
  doubles.value:""
 elseif c=2
  doubles.value:"Doubles!!"
 elseif c=3
  doubles.value:"Triples!!!"
 elseif c=4
  doubles.value:"Quadruples????"
 elseif c=5
  doubles.value:"Quintuples?!?!?"
 elseif c=6
  doubles.value:"SEXTUPLES!?!?!?"
 else
  doubles.value:"I give up"
 end
end
{end}

{contraption:Spell}
size:[166,72]
resizable:1
margin:[0,21,0,0]
description:"Spell card with name field, description, and 2 small custom fields (range/duration?)"
attributes:{"name":[],"label":[],"type":[]}
{widgets}
Description:{"type":"field","size":[166,52],"pos":[0,20],"scrollbar":1}
name:{"type":"field","size":[94,20],"pos":[0,0],"style":"plain"}
customfield1:{"type":"field","size":[35,20],"pos":[95,0],"style":"plain"}
customfield2:{"type":"field","size":[35,20],"pos":[131,0],"style":"plain"}

{contraption:Delta}
size:[150,81]
resizable:1
margin:[16,24,0,0]
description:"Text field with the delta symbol, just because I don't want to have to import the image over and over.\nAlso has a checkbox to toggle the text field on/off."
image:"%%IMG2AJYAUQD/AMcBAQCUAQEAAQEBAJMBAQABAQEAAwEBAI4BAQADAQEAkQEBAAMBAQCQAQEABQEBAI8BBwABAQEA/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8AUA=="
script:"Delta.0"
{widgets}
field1:{"type":"field","size":[135,81],"pos":[15,0],"show":"invert","scrollbar":1}
checkbox:{"type":"button","size":[13,13],"pos":[0,11],"script":"Delta.1","style":"check","value":0}

{script:Delta.0}
on view do
 if checkbox.value
  field1.show:"solid"
 else
  field1.show:"invert"
 end
end
{end}

{script:Delta.1}
on click do
 if me.value
  field1.show:"solid"
 else
  field1.show:"invert"
 end
end
{end}

{contraption:statroller}
size:[150,102]
resizable:1
margin:[47,17,0,74]
description:"Has a list of stat scores from 1-20, and can roll each of them.\nUse the \"setstat\" function.\nThe first argument is which stat you're setting, top-to-bottom, zero-indexed.\nThe second is a string, ideally a short abbreviation.\nThe third is the stat score. Modifiers are automatically calculated."
script:"statroller.0"
attributes:{"name":[],"label":[],"type":[]}
{widgets}
label:{"type":"field","size":[46,16],"pos":[0,0],"locked":1,"font":"menu","show":"invert","value":"Rolls"}
button1:{"type":"button","size":[46,12],"pos":[0,30],"script":"statroller.1","font":"body","text":"Str"}
button2:{"type":"button","size":[46,12],"pos":[0,42],"script":"statroller.2","font":"body","text":"Dex"}
button3:{"type":"button","size":[46,12],"pos":[0,54],"script":"statroller.3","font":"body","text":"Con"}
button4:{"type":"button","size":[46,12],"pos":[0,66],"script":"statroller.4","font":"body","text":"Int"}
button5:{"type":"button","size":[46,12],"pos":[0,78],"script":"statroller.5","font":"body","text":"Wis"}
button6:{"type":"button","size":[46,12],"pos":[0,90],"script":"statroller.6","font":"body","text":"Cha"}
roll:{"type":"field","size":[100,102],"pos":[50,0],"scrollbar":1,"style":"plain","align":"center","value":"5\n20\n20\n20\n20\n20"}
grid1:{"type":"grid","size":[65,106],"pos":[-110,-4],"locked":1,"show":"none","bycell":1,"format":"i","value":{"score":[10,10,10,10,10,10]},"row":0,"col":0}
d20:{"type":"button","size":[46,12],"pos":[0,18],"script":"statroller.7","font":"body","text":"1d20"}

{script:statroller.0}
on do_roll n do
 grid1.cell:(0,n)
 a:random[20]+1
 stat:grid1.cellvalue
 r:if stat>a "%i X" format a else "%i _/" format a end
 roll.text:"\n" fuse r, roll.text
end

on setstat num abbr score do
 grid1.cell:(0,num)
 grid1.cellvalue:score
 if num=0
  button1.text:abbr
 elseif num=1
  button2.text:abbr
 elseif num=2
  button3.text:abbr
 elseif num=3
  button4.text:abbr
 elseif num=4
  button5.text:abbr
 elseif num=5
  button6.text:abbr
 end
end

on get_setstat do
 setstat
end
{end}

{script:statroller.1}
on click do
 card.event["do_roll" 0]
end
{end}

{script:statroller.2}
on click do
 card.event["do_roll" 1]
end
{end}

{script:statroller.3}
on click do
 card.event["do_roll" 2]
end
{end}

{script:statroller.4}
on click do
 card.event["do_roll" 3]
end
{end}

{script:statroller.5}
on click do
 card.event["do_roll" 4]
end
{end}

{script:statroller.6}
on click do
 card.event["do_roll" 5]
end
{end}

{script:statroller.7}
on click do
 roll.text:"\n" fuse (random[20]+1), roll.text
end
{end}

{contraption:enum}
size:[100,25]
resizable:1
margin:[5,5,5,5]
description:"select from among enumerated string values."
script:"enum.0"
template:"on change val do\n \nend"
attributes:{"name":["options"],"label":["Options"],"type":["code"]}
{widgets}
s:{"type":"slider","size":[100,25],"pos":[0,0],"script":"Home.9","interval":[0,100],"style":"compact"}
o:{"type":"field","size":[100,20],"pos":[0,-30],"locked":1,"script":"Home.9","style":"plain"}

{script:enum.0}
on get_options   do o.text end
on get_value     do ("\n" split o.text)[s.value] end
on set_options x do o.text:x s.value:0 view[] end

on set_value x do
 v:"\n" split o.text
 d:v dict range count v
 s.interval:0,(count v)-1
 s.value:v[0] unless d[x]
 s.format:v[s.value]
 s.font:card.font
 s.show:card.show
 s.locked:card.locked
end

on change do
 view[]
 card.event["change" get_value[]]
end

on view do
 v:"\n" split o.text
 s.interval:0,(count v)-1
 s.format:v[s.value]
 s.font:card.font
 s.show:card.show
 s.locked:card.locked
end

{end}

{contraption:DerivedStatistic}
size:[50,21]
margin:[0,0,0,0]
script:"DerivedStatistic.0"
attributes:{"name":["abbr"],"label":[""],"type":["string"]}
{widgets}
name:{"type":"field","size":[28,20],"pos":[0,0],"locked":1,"script":"DerivedStatistic.1","style":"plain","value":"Str"}
val:{"type":"field","size":[20,20],"pos":[29,0],"locked":1,"script":"Home.9","style":"code","value":"0"}

{script:DerivedStatistic.0}
on get_value do
 val.text+0
end

on set_value x do
 val.text:x
end

on get_abbr do
 name.text
end

on set_abbr x do
 name.text:x
end

on update_stat level dex_bonus cha_bonus armor_bonus armor_penalty do
 print["updating %s: %i %i %i %i %i" format (name.text, level, dex_bonus, cha_bonus, armor_bonus, armor_penalty)]
 if name.text="Atk"
  print["actually updating %s" format name.text]
  # attack: Starts at 11. Increases with level
  level_mod:((floor (level / 2)) & 4)
  set_value[(11 + level_mod)]
 elseif name.text="Def"
   print["actually updating %s" format name.text]
  # defense: 10 + Dex. Bonus OR bonus from armour
  set_value[(10 + (dex_bonus | armor_bonus))]
 elseif name.text="Mov"
   print["actually updating %s" format name.text]
  # movement: 12 + Dex. Bonus - Armour penalty
  set_value[(12 + dex_bonus + armor_penalty)]
 elseif name.text="Stlth"
   print["actually updating %s" format name.text]
  # stealth: 5 + Dex. Bonus - Armour penalty
  set_value[(5 + dex_bonus + armor_penalty)]
 elseif name.text="Save"
   print["actually updating %s" format name.text]
  # save: 5 + Cha. Bonus. Increases with level.
  if level=0
   base_save:5
  elseif level=1
   base_save:6
  elseif level<5
   base_save:7
  elseif level<8
   base_save:8
  elseif level<10
   base_save:9
  else
   base_save:10
  end
  set_value[(base_save + cha_bonus)]
 else
  sys.panic["Unknown derived statistic"]
 end
end

on get_update_stat do
 update_stat
end
{end}

{script:DerivedStatistic.1}
on change val do
end
{end}

